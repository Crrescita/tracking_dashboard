<div id="salary-invoice">
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col-4">
              <ngx-simplebar class="chat-message-list chat-bookmark-list">
                <ul class="list-unstyled chat-list">
                  <li>
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <h5 class="mb-1">
                          <a
                            href="javascript:void(0);"
                            class="text-truncate p-0"
                            >Invoice of Month</a
                          >
                        </h5>
                      </div>

                      <div class="flex-shrink-0 ms-3">
                        <div class="input-group">
                          <input
                            type="text"
                            id="datepicker"
                            class="form-control"
                            showWeekNumbers="false"
                            bsDatepicker
                            [bsConfig]="bsConfig"
                            [(ngModel)]="selectedDate"
                            (bsValueChange)="onDateChange($event)"
                          />
                          <div class="input-group-append">
                            <label
                              for="datepicker"
                              class="input-group-text cursor-pointer"
                            >
                              <i class="ri-calendar-fill"></i>
                            </label>
                          </div>
                        </div>
                        <!-- <p class="text-muted text-truncate fs-xs mb-0">{{this.formattedDate | date : " MMMM"}}</p>    -->
                      </div>
                    </div>
                  </li>

                  <li>
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <h5 class="mb-1">
                          <a
                            href="javascript:void(0);"
                            class="text-truncate p-0"
                            >Paid Days</a
                          >
                        </h5>
                      </div>

                      <div class="flex-shrink-0 ms-3">
                        <p class="text-muted text-truncate fs-xs mb-0">
                          {{ this.presentDays }}
                        </p>
                      </div>
                    </div>
                  </li>

                  <li>
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <h5 class="mb-1">
                          <a
                            href="javascript:void(0);"
                            class="text-truncate p-0"
                            >Balance Advance</a
                          >
                        </h5>
                      </div>

                      <div class="flex-shrink-0 ms-3">
                        <p class="text-muted text-truncate fs-xs mb-0">
                            <i class="bx bx-rupee"></i>  {{ this.totalAdvBal | number:'1.0-2'}}
                        </p>
                      </div>
                    </div>
                  </li>

                  <li>
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <h5 class="mb-1">
                          <a
                            href="javascript:void(0);"
                            class="text-truncate p-0"
                            >Pay Slip Genrated</a
                          >
                        </h5>
                      </div>

                      <div class="flex-shrink-0 ms-3">
                        <p class="text-muted text-truncate fs-xs mb-0">
                          {{ this.gernated }}
                        </p>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="d-flex align-items-center">
                      <div class="flex-grow-1 overflow-hidden">
                        <h5 class="mb-1">
                          <a
                            href="javascript:void(0);"
                            class="text-truncate p-0"
                            >Monthly Salary</a
                          >
                        </h5>
                      </div>

                      <div class="flex-shrink-0 ms-3">
                        <p class="text-muted text-truncate fs-xs mb-0">
                            <i class="bx bx-rupee"></i>  {{ this.salaryDetailData.netSalary | number:'1.0-2'}}
                        </p>
                      </div>
                    </div>
                  </li>
                </ul>
              </ngx-simplebar>
            </div>
            <div class="col-4 ">
                <div class="p-3 bg-light rounded courses-calendar-dashboard">
                    <div class="d-flex align-items-center gap-2 mb-4">
                        <!-- <div class="flex-shrink-0">
                            <button class="btn btn-sm btn-secondary"><i class="bi bi-chevron-left"></i></button>
                        </div> -->
                        <h6 class="flex-grow-1 mb-0 text-center fs-md">
                            {{this.formattedDate | date : " MMMM - YYYY"}}
                        </h6>
                        <!-- <div class="flex-shrink-0">
                            <button class="btn btn-sm btn-secondary"><i class="bi bi-chevron-right"></i></button>
                        </div> -->
                    </div>
                    <div class="calendar-container">
                        <!-- Week Days Header (Static) -->
                     
                        <div class="weekdays ">
                          <div *ngFor="let day of weekDays" class="weekday">{{ day }}</div>
                        </div>
                      
                        <!-- Dates Grid (for the entire month) -->
                        <div class="dates-grid ">
                          <!-- Empty cells for correct alignment (if month starts on a day other than Sunday) -->
                          <div *ngFor="let empty of emptyCells" class="date-box">
                            <div class="date-box"></div>
                          </div>
                      
                          <!-- Dates with attendance highlighting -->
                          <!-- <div 
                            *ngFor="let date of highlightedDates"
                            class="date-box"
                            (click)="
                            template.show();
                            setModalData(date)
                          "
                            [ngClass]="date.className">
                            <div class="date">
                              {{ date.date | date: 'dd' }}
                            </div>
                          </div> -->

                          <div  *ngFor="let date of highlightedDates" dropdown class="btn-group">
                            <a dropdownToggle class="date-box "[ngClass]="date.className"
                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                {{ date.date | date: 'dd' }}
                            </a>
                            <div *dropdownMenu class="dropdown-menu dropdown-menu-md p-4">

                                <div class="d-flex align-items-center  px-2" [ngClass]="date.updated_by  || date.attendance_status === 'Absent' ||  date.attendance_status === 'Holiday'? 'mb-3':''">        
                                    <div>
                                      <span class="text-mute me-2">{{
                                        date.date | date : "EEE, MMM d, y"
                                      }}</span>
                                      <span
                                        class="badge"
                                        [ngClass]="
                                          date.attendance_status == 'Absent'
                                            ? 'bg-danger'
                                            : 'bg-success'
                                        "
                                        >{{ date.attendance_status }}
                                   
                                      </span>
                                    </div>
                                  </div>
                                <!-- {{ date.date | date: 'dd,MMM,YYYY' }}
                                {{date.attendance_status}} -->
                                @if(date.updated_by || date.attendance_status === 'Absent' ||  date.attendance_status === 'Holiday'){
                                    <form [formGroup]="formGroupSetPresent">
                                        <h6 class="ms-2" >Edit Attendance</h6>
                                        <div class="mb-3 d-flex justify-content-evenly">
                                          <button
                                            type="button"
                                            class="btn"
                                            [ngClass]="{
                                              'btn-danger': date.attendance_status === 'Absent',
                                              'btn-outline-danger': date.attendance_status !== 'Absent'
                                            }"
                                            (click)="setStatus('Absent', date.date)"
                                          >
                                            Absent
                                          </button>
                                      
                                          <button
                                            type="button"
                                            class="btn"
                                            [ngClass]="{
                                              'btn-success': date.attendance_status === 'Present',
                                              'btn-outline-success': date.attendance_status !== 'Present'
                                            }"
                                            (click)="setStatus('Present', date.date)"
                                          >
                                            Present
                                          </button>
                                        </div>
                                      </form>
                                }
                               
                                  
                            </div>
                        </div>
                        </div>
                      </div>
                </div>

                <!-- <div>
                    <div
                      bsModal
                      #template="bs-modal"
                      id="myModal"
                      class="modal fade"
                      tabindex="-1"
                      aria-labelledby="myModalLabel"
                      aria-hidden="true"
                      style="display: none"
                    >
                      <div class="modal-dialog modal-xs">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title fs-lg" id="myModalLabel">Attendance Info</h5>
                            <button
                              type="button"
                              class="btn-close"
                              (click)="template.hide()"
                            ></button>
                          </div>
                          <div class="modal-body">
                            @if(this.timeLineData ){
                                @if(this.timeLineData.attendance_status == 'Present'){
                                    <div class="row">
                                        <div class="col-lg-12">
                                          <div class="card">
                                            <div class="card-header">
                                              <h6 class="card-title mb-0">Timesheet</h6>
                            
                                              <div class="d-flex align-items-center mt-3">
                                              
                                                <div>
                                               
                                                  <span class="text-mute me-2">{{
                                                    this.timeLineData.date | date : "EEE, MMM d, y"
                                                  }}</span>
                                                  <span
                                                    class="badge"
                                                    [ngClass]="
                                                      this.timeLineData.checkin_status == 'Early'
                                                        ? 'bg-warning'
                                                        : this.timeLineData.checkin_status == 'Late'
                                                        ? 'bg-danger'
                                                        : 'bg-success'
                                                    "
                                                    >{{ this.timeLineData.checkin_status }}
                                                    @if(this.timeLineData.checkin_status != 'On-Time'){ by
                                                    {{ this.timeLineData.timeDifference }}
                                                    }
                                                  </span>
                                                </div>
                                              </div>
                                             
                                            </div>
                            
                                            <div class="card-body">
                                              <div class="row g-3">
                                                <div class="col-md-12">
                                                  <div class="card border shadow-none mb-0 check-bg">
                                                    <div class="card-body p-2">
                                                      <div class="text-center">
                                                        <p class="text-muted text-truncate mb-2">
                                                          Check In at
                                                        </p>
                                                        <h6 class="fs-lg">
                                                          {{
                                                            formatTime(this.timeLineData.earliestCheckInTime)
                                                          }}
                                                        </h6>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                            
                                                <div class="punch-info">
                                                  <div class="punch-hours">
                                                    <span>{{ this.timeLineData.totalDuration }} hrs</span>
                                                  </div>
                                                </div>
                            
                                                <div class="col-md-12">
                                                  <div class="card border shadow-none mb-0 check-bg">
                                                    <div class="card-body p-2">
                                                      <div class="text-center">
                                                        <p class="text-muted text-truncate mb-2">
                                                          Check Out at
                                                        </p>
                                                        <h6 class="fs-lg">
                                                          @if( this.timeLineData.latestCheckOutTime ==
                                                          '-'){ Not Check-out Yet } @else {
                                                          {{
                                                            formatTime(
                                                              this.timeLineData.latestCheckOutTime
                                                            )
                                                          }}
                                                          }
                                                        </h6>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      
                                      </div>
                                }@else {
                                    
                                    <form
                                    (ngSubmit)="onSubmitStatus()"
                                    [formGroup]="formGroupSetPresent"
                                    class="tablelist-form"
                                    novalidate
                                    autocomplete="off"
                                  >
                                    <div class="modal-body p-4">
                                      <div class="mb-3 d-flex justify-content-evenly">
                                        <button
                                          type="button"
                                          class="btn btn-label"
                                          [ngClass]="{
                                            'btn-danger': selectedStatus === 'Absent',
                                            'btn-outline-danger': selectedStatus !== 'Absent'
                                          }"
                                          (click)="setStatus('Absent')"
                                        >
                                          <i class="ri-check-double-line label-icon align-middle fs-lg me-2"></i>
                                          Absent
                                        </button>
                                  
                                        <button
                                          type="button"
                                          class="btn btn-label"
                                          [ngClass]="{
                                            'btn-success': selectedStatus === 'Present',
                                            'btn-outline-success': selectedStatus !== 'Present'
                                          }"
                                          (click)="setStatus('Present')"
                                        >
                                          <i class="ri-check-double-line label-icon align-middle fs-lg me-2"></i>
                                          Present
                                        </button>
                                      </div>
                                    </div>
                                  
                                    <div class="modal-footer">
                                      <div class="hstack gap-2 justify-content-end">
                                       
                                        <button type="submit" class="btn btn-primary" id="add-btn">
                                          Save
                                        </button>
                                      </div>
                                    </div>
                                  </form>
                                  

                                }
                           
                            }
                          </div>
                        
                        </div>
                       
                      </div>
                     
                    </div>
                   
                  </div> -->
            </div>
          </div>
        </div>

        <div class="card-body">
          <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
            <div class="row g-3">
              <table
                class="table table-bordered table-nowrap mb-0 ms-auto ml-5"
              >
                <tbody>
                  <tr>
                    <th scope="row">
                      <table
                        class="table table-bordered table-nowrap align-middle mb-0 ms-auto ml-5"
                      >
                        <tbody>
                          <tr class="border-top border-top-dashed fs-base">
                            <th scope="row">Net Salary :</th>
                            <th class="text-end">
                              <div class="input-group">
                                <span class="input-group-text"
                                  ><i class="bx bx-rupee"></i
                                ></span>
                                <input
                                  type="number"
                                  formControlName="salary"
                                  class="form-control text-end"
                                  id="salary_id"
                                  placeholder=""
                                />
                                @if (f['salary'] &&
                                f['salary'].hasError('required') &&
                                f['salary'].touched) {
                                <div class="invalid-text">
                                  Salary is required.
                                </div>
                                } @if(f['salary'] &&
                                f['salary'].hasError('minlength') &&
                                f['salary'].touched){
                                <div class="invalid-text">
                                  Salary must be at least 0.
                                </div>
                                }
                              </div>
                            </th>
                          </tr>
                        </tbody>
                      </table>

                      <div class="mt-2">
                        <table
                          class="invoice-table table table-borderless table-nowrap mb-0"
                        >
                          <thead class="align-middle">
                            <tr class="table-light">
                              <th scope="col" style="width: 50px">#</th>
                              <th scope="col">Earning</th>

                              <th scope="col">Calculation</th>
                              <th scope="col" class="text-end">Amount</th>
                              <th scope="col" class="text-end"></th>
                            </tr>
                          </thead>
                          <tbody id="newlink" formArrayName="breakup">
                            @for (data of breakup.controls; track $index) {
                            <tr
                              id="{{ $index + 1 }}"
                              class="product-elem border-top border-top-dashed"
                              [formGroupName]="$index"
                            >
                              <td scope="row" class="product-id">
                                <p class="mt-2">{{ $index + 1 }}</p>
                              </td>
                              <td class="text-start">
                                <div class="mb-2">
                                  <input
                                    type="text"
                                    class="form-control"
                                    id="name-{{ $index + 1 }}"
                                    formControlName="name"
                                    [value]="data.get('name')?.value"
                                    placeholder="Enter name"
                                    [readonly]="
                                      data.get('nameReadonly')?.value ||
                                      $index === 0
                                    "
                                    [ngClass]="
                                      data.get('nameReadonly')?.value
                                        ? 'disable-bg'
                                        : ''
                                    "
                                  />

                                  <div
                                    *ngIf="
                                      data.get('name')?.invalid &&
                                      data.get('name')?.touched
                                    "
                                  >
                                    <small class="invalid-text">
                                      Please enter a name.</small
                                    >
                                  </div>
                                </div>
                              </td>

                              <td class="text-end">
                                <div>
                                    <div class="d-flex align-items-center">
                                     
                                        <select
                                        class="form-select"
                                        [value]="data.get('calculationType')?.value"
                                        [formControlName]="'calculationType'"
                                        (change)="
                                          onCalculationTypeChange(
                                            $event,
                                            $index,
                                            data
                                          )
                                        "
                                      >
                                      <ng-container
                                  *ngIf="data.get('formula')?.value"
                                >
                                  <option [value]="'default'">Default</option>
                                </ng-container>
                                   
                                        <option [value]="'custom'">Custom</option>
                                        <option [value]="'formula'">
                                          Formula Builder
                                        </option>
                                      </select>
    
                                      @if(data.get('calculationType')?.value == 'default' || data.get('calculationType')?.value === 'formula'){
                                        <a   class="ms-2 fs-4 tooltip-primary" data-bs-toggle="tooltip" placement="top"
                                        [tooltip]="data.get('formula')?.value">
                                        <i class=" ri-information-fill"></i>
                                        </a>                                  
                                     }
                                    </div>
                                 

                                  <!-- Formula Builder Input -->
                                  <div
                                    *ngIf="
                                      data.get('calculationType')?.value ===
                                      'formula'
                                    "
                                  >
                                    <!-- <input
                                                  type="text"
                                                  class="form-control"
                                                  formControlName="formula"
                                                  placeholder="Enter formula (e.g., netSalary + totalAmount)"
                                                />
                                                <small class="text-muted">
                                                  Use valid expressions for calculation.
                                                </small>
                            
                                             
                                                <div class="mt-2">
                                                  <label for="variables">Choose Variables:</label>
                                                  <div>
                                                    <a
                                                      *ngFor="let variable of availableVariables"
                                                      class="btn btn-outline-secondary btn-sm"
                                             
                                                      (click)="insertVariable(variable, $index, false)"
                                                    >
                                                      {{ variable.name }}: {{ variable.value }}
                                                    </a>
                                                  </div>
                                                </div>
                            
                                             
                                                <div class="mt-2">
                                                  <label for="operations">Choose Operations:</label>
                                                  <div>
                                                    <a
                                                      *ngFor="let operation of operations"
                                                      class="btn btn-outline-secondary btn-sm"
                                                      (click)="insertOperation(operation, $index, false)"
                                                    >
                                                      {{ operation }}
                                                    </a>
                                                  </div>
                                                </div>
                            
                                                <button
                                                  type="button"
                                                  class="btn btn-outline-secondary btn-sm mt-2"
                                                  (click)="evaluateFormula($index)"
                                                >
                                                  Evaluate
                                                </button> -->

                                    <div class="mt-1 text-start">
                                      <a
                                        (click)="template.show()"
                                        class="icon-link icon-link-hover text-start link-effect fw-normal"
                                        style="
                                          --tb-icon-link-transform: translate3d(
                                            0,
                                            -0.125rem,
                                            0
                                          );
                                        "
                                      >
                                        <i class="bi bi-calculator"></i>
                                        Calculator
                                      </a>
                                    </div>

                                    <div
                                      bsModal
                                      #template="bs-modal"
                                      id="myModal"
                                      class="modal fade"
                                      tabindex="-1"
                                      aria-labelledby="myModalLabel"
                                      aria-hidden="true"
                                      style="display: none"
                                    >
                                      <div class="modal-dialog">
                                        <div class="modal-content">
                                          <div class="modal-header">
                                            <h5
                                              class="modal-title"
                                              id="myModalLabel"
                                            >
                                              Formula Builder
                                            </h5>
                                            <button
                                              type="button"
                                              class="btn-close"
                                              (click)="template.hide()"
                                            ></button>
                                          </div>
                                          <div class="modal-body">
                                            <div class="formula-calculator">
                                              <!-- Formula Display -->
                                              <div class="formula-display mb-3">
                                                <input
                                                  type="text"
                                                  class="form-control"
                                                  [formControlName]="'formula'"
                                                  [placeholder]="
                                                    'Enter formula'
                                                  "
                                                />
                                                <!-- [readonly]="true" -->
                                              </div>
                                              <small class="text-muted">
                                                Use valid expressions for
                                                calculation.
                                              </small>
                                              <!-- Variables Section -->
                                              <div
                                                class="variables-section mb-3"
                                              >
                                                <label class="d-block mb-2"
                                                  >Variables</label
                                                >
                                                <div class="variables-grid">
                                                  <a
                                                    *ngFor="
                                                      let variable of availableVariables
                                                    "
                                                    class="btn btn-outline-primary calc-btn"
                                                    (click)="
                                                      insertVariable(
                                                        variable,
                                                        $index,
                                                        false
                                                      )
                                                    "
                                                  >
                                                    {{ variable.name }}:
                                                    {{ variable.value }}
                                                  </a>
                                                </div>
                                              </div>

                                              <!-- Calculator Grid -->
                                              <div class="calculator-grid">
                                                <!-- Numbers and Operations -->
                                                <div class="calc-buttons">
                                                  <div class="row g-1">
                                                    <div
                                                      class="col-3"
                                                      *ngFor="
                                                        let num of [7, 8, 9]
                                                      "
                                                    >
                                                      <a
                                                        class="btn btn-light calc-btn w-100"
                                                        (click)="
                                                          appendNumber(
                                                            num,
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >{{ num }}</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-warning calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '/',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >/</a
                                                      >
                                                    </div>
                                                  </div>
                                                  <div class="row g-1 mt-1">
                                                    <div
                                                      class="col-3"
                                                      *ngFor="
                                                        let num of [4, 5, 6]
                                                      "
                                                    >
                                                      <a
                                                        class="btn btn-light calc-btn w-100"
                                                        (click)="
                                                          appendNumber(
                                                            num,
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >{{ num }}</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-warning calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '*',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >Ã—</a
                                                      >
                                                    </div>
                                                  </div>
                                                  <div class="row g-1 mt-1">
                                                    <div
                                                      class="col-3"
                                                      *ngFor="
                                                        let num of [1, 2, 3]
                                                      "
                                                    >
                                                      <a
                                                        class="btn btn-light calc-btn w-100"
                                                        (click)="
                                                          appendNumber(
                                                            num,
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >{{ num }}</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-warning calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '-',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >-</a
                                                      >
                                                    </div>
                                                  </div>
                                                  <div class="row g-1 mt-1">
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-light calc-btn w-100"
                                                        (click)="
                                                          appendNumber(
                                                            0,
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >0</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-light calc-btn w-100"
                                                        (click)="
                                                          appendDecimal(
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >.</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-danger calc-btn w-100"
                                                        (click)="
                                                          clear($index, false)
                                                        "
                                                        >C</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-warning calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '+',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >+</a
                                                      >
                                                    </div>
                                                  </div>
                                                  <div class="row g-1 mt-1">
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-secondary calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '(',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >(</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-secondary calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            ')',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >)</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-secondary calc-btn w-100"
                                                        (click)="
                                                          insertOperation(
                                                            '%',
                                                            $index,
                                                            false
                                                          )
                                                        "
                                                        >%</a
                                                      >
                                                    </div>
                                                    <div class="col-3">
                                                      <a
                                                        class="btn btn-success calc-btn w-100"
                                                        (click)="
                                                          evaluateFormula(
                                                            $index
                                                          );
                                                          template.hide()
                                                        "
                                                        >=</a
                                                      >
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                          <!-- <div class="modal-footer">
                                                                    <button type="button" class="btn btn-light" (click)="template.hide()">Close</button>
                                                                    <button type="button" class="btn btn-primary ">Save Changes</button>
                                                                </div> -->
                                        </div>
                                        <!-- /.modal-content -->
                                      </div>
                                      <!-- /.modal-dialog -->
                                    </div>
                                  </div>

                                  <div
                                    *ngIf="
                                      data.get('formula')?.invalid &&
                                      data.get('formula')?.touched &&
                                      data.get('calculationType')?.value ===
                                        'formula'
                                    "
                                  >
                                    <small class="invalid-text"
                                      >Formula is required.</small
                                    >
                                  </div>
                                </div>
                              </td>

                              <td class="text-end">
                                <div class="input-group">
                                  <span class="input-group-text"
                                    ><i class="bx bx-rupee"></i
                                  ></span>
                                  <input
                                    class="form-control invoice-product-line-price text-end"
                                    type="number"
                                    id="amount-{{ $index }}"
                                    formControlName="amount"
                                    [value]="data.get('amount')?.value"
                                    thousandSeparator=","
                                    decimalMarker="."
                                    placeholder="Enter amount"
                                    (input)="
                                      validateTotal();
                                      onFormulaInput($event, $index)
                                    "
                                    [readonly]="
                                      data.get('calculationType')?.value ===
                                        'formula' ||
                                      data.get('calculationType')?.value ===
                                        'default'
                                    "
                                  />

                                  <div
                                    *ngIf="
                                      data.get('amount')?.invalid &&
                                      data.get('amount')?.touched
                                    "
                                  >
                                    <small class="invalid-text"
                                      >Amount is required and must be
                                      positive.</small
                                    >
                                  </div>
                                </div>
                              </td>
                              <td class="product-removal">
                                @if($index != 0){
                                <a
                                  href="javascript:void(0)"
                                  class="btn btn-danger"
                                  (click)="removeRow($index)"
                                >
                                  <i class="ri-delete-bin-2-line"></i
                                ></a>
                                }
                              </td>
                            </tr>
                            }
                          </tbody>

                          <tbody>
                            <tr>
                              <td colspan="5">
                                <a
                                  href="javascript:void(0)"
                                  id="add-item"
                                  class="fw-medium"
                                  (click)="openAllowance(allowanceSelect)"
                                  ><i class="ri-add-fill me-1 align-bottom"></i>
                                  Add Allowance</a
                                >
                                <div
                                  class="col-3"
                                  [ngClass]="
                                    showAllowanceSelect ? 'd-block' : 'd-none'
                                  "
                                >
                                  <ng-container>
                                    <ng-select
                                      #allowanceSelect
                                      [items]="allowances"
                                      (change)="onSelectionChange($event)"
                                      bindLabel="name"
                                      placeholder="Select Allowance"
                                    >
                                      <ng-template ng-footer-tmp>
                                        <a
                                          class="btn btn-sm btn-primary w-100"
                                          (click)="addRow(null)"
                                        >
                                          Add Custom
                                        </a>
                                      </ng-template>
                                    </ng-select>
                                  </ng-container>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                          <tfoot class="table-light">
                            <tr>
                              <td colspan="2">
                                <strong>Total Earning</strong>
                              </td>
                              <td colspan="2" class="text-end">
                                <i class="bx bx-rupee"></i> {{ earningTotal | number:'1.0-2' }}
                              </td>
                              <td></td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    </th>
                    <th>
                      <table
                        class="table table-bordered table-nowrap align-middle mb-0 ms-auto"
                      >
                        <tbody>
                          <tr>
                            <th class="text-end">
                              <div
                                class="hstack gap-2 justify-content-end align-items-end"
                              >
                              @if(!this.gernated){
                                @if (saveButtonActive) {
                                    <button class="btn btn-primary">Generate Payroll</button>
                                    } @else {
                                    <button
                                      class="btn btn-secondary"
                                      type="button"
                                      disabled
                                    >
                                      <span
                                        class="spinner-border spinner-border-sm"
                                        role="status"
                                        aria-hidden="true"
                                      ></span>
                                      Please wait
                                    </button>
                                    }
                              }@else {
                                <a  (click)="tooltipmodal.show()" class="btn btn-success">Print Payroll</a>
                              }
                                
                              </div>
                            </th>
                          </tr>
                        </tbody>
                      </table>

                      <div class="table-responsive mt-2">
                        <table
                          class="invoice-table table table-borderless table-nowrap mb-0"
                        >
                          <thead class="align-middle">
                            <tr class="table-light">
                              <th scope="col" style="width: 50px">#</th>
                              <th scope="col">Deductions</th>

                              <th scope="col">Calculation</th>
                              <th scope="col" class="text-end">Amount</th>
                              <th scope="col" class="text-end"></th>
                            </tr>
                          </thead>
                          <tbody formArrayName="deductions">
                            @for (data of deductions.controls; track $index) {
                            <tr
                              class="border-top border-top-dashed mt-2"
                              [formGroupName]="$index"
                            >
                              <th scope="row" class="product-id">
                                {{ $index + 1 }}
                              </th>
                              <td class="text-start">
                                <div class="mb-2">
                                  <input
                                    type="text"
                                    class="form-control"
                                    id="name-deduction-{{ $index + 1 }}"
                                    formControlName="name"
                                    placeholder="Enter name"
                                    [readonly]="data.get('nameReadonly')?.value"
                                    [ngClass]="
                                      data.get('nameReadonly')?.value
                                        ? 'disable-bg'
                                        : ''
                                    "
                                  />
                                </div>
                              </td>
                              <td class="text-end">
                              <div class="d-flex align-items-center">
              
                                <select
                                class="form-select"
                                [formControlName]="'calculationType'"
                                [value]="data.get('calculationType')?.value"
                                (change)="
                                  onCalculationDeductionTypeChange(
                                    $event,
                                    $index
                                  )
                                "
                              >
                                <option [value]="'none'">None</option>
                                <ng-container
                                  *ngIf="data.get('name')?.value === 'PF'"
                                >
                                  <option [value]="'percentage'">12%</option>
                                </ng-container>

                                <ng-container
                                  *ngIf="data.get('name')?.value === 'ESI'"
                                >
                                  <option [value]="'percentage'">
                                    0.75%
                                  </option>
                                </ng-container>

                                <ng-container
                                  *ngIf="
                                    data.get('name')?.value === 'Advance'
                                  "
                                >
                                  <option [value]="'100%'">100%</option>
                                  <option [value]="'50%'">50%</option>
                                </ng-container>
                                <option [value]="'custom'">Custom</option>
                                <option [value]="'formula'">
                                  Formula Builder
                                </option>
                              </select>

                              @if(data.get('calculationType')?.value == 'percentage' || data.get('calculationType')?.value === 'formula'){
                                  <a   class="ms-2 fs-4 tooltip-primary" data-bs-toggle="tooltip" placement="top"
                                  [tooltip]="data.get('formula')?.value">
                                  <i class=" ri-information-fill"></i>
                                  </a>                                  
                               }
                              </div>

                               

                                <div
                                  *ngIf="
                                    data.get('calculationType')?.value ===
                                    'formula'
                                  "
                                >
                                  <div class="mt-1 text-start">
                                    <a
                                      (click)="template.show()"
                                      class="icon-link icon-link-hover text-start link-effect fw-normal"
                                      style="
                                        --tb-icon-link-transform: translate3d(
                                          0,
                                          -0.125rem,
                                          0
                                        );
                                      "
                                    >
                                      <i class="bi bi-calculator"></i>
                                      Calculator
                                    </a>
                                  </div>

                                  <div
                                    bsModal
                                    #template="bs-modal"
                                    id="myModal"
                                    class="modal fade"
                                    tabindex="-1"
                                    aria-labelledby="myModalLabel"
                                    aria-hidden="true"
                                    style="display: none"
                                  >
                                    <div class="modal-dialog">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5
                                            class="modal-title"
                                            id="myModalLabel"
                                          >
                                            Formula Builder
                                          </h5>
                                          <button
                                            type="button"
                                            class="btn-close"
                                            (click)="template.hide()"
                                          ></button>
                                        </div>
                                        <div class="modal-body">
                                          <div class="formula-calculator">
                                            <!-- Formula Display -->
                                            <div class="formula-display mb-3">
                                              <input
                                                type="text"
                                                class="form-control"
                                                [formControlName]="'formula'"
                                                [placeholder]="'Enter formula'"
                                              />
                                              <!-- [readonly]="true" -->
                                            </div>
                                            <small class="text-muted">
                                              Use valid expressions for
                                              calculation.
                                            </small>
                                            <!-- Variables Section -->
                                            <div class="variables-section mb-3">
                                              <label class="d-block mb-2"
                                                >Variables</label
                                              >
                                              <div class="variables-grid">
                                                <a
                                                  *ngFor="
                                                    let variable of availableVariables
                                                  "
                                                  class="btn btn-outline-primary calc-btn"
                                                  (click)="
                                                    insertVariable(
                                                      variable,
                                                      $index,
                                                      true
                                                    )
                                                  "
                                                >
                                                  {{ variable.name }}:
                                                  {{ variable.value }}
                                                </a>
                                              </div>
                                            </div>

                                            <!-- Calculator Grid -->
                                            <div class="calculator-grid">
                                              <!-- Numbers and Operations -->
                                              <div class="calc-buttons">
                                                <div class="row g-1">
                                                  <div
                                                    class="col-3"
                                                    *ngFor="
                                                      let num of [7, 8, 9]
                                                    "
                                                  >
                                                    <a
                                                      class="btn btn-light calc-btn w-100"
                                                      (click)="
                                                        appendNumber(
                                                          num,
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >{{ num }}</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-warning calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '/',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >/</a
                                                    >
                                                  </div>
                                                </div>
                                                <div class="row g-1 mt-1">
                                                  <div
                                                    class="col-3"
                                                    *ngFor="
                                                      let num of [4, 5, 6]
                                                    "
                                                  >
                                                    <a
                                                      class="btn btn-light calc-btn w-100"
                                                      (click)="
                                                        appendNumber(
                                                          num,
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >{{ num }}</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-warning calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '*',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >Ã—</a
                                                    >
                                                  </div>
                                                </div>
                                                <div class="row g-1 mt-1">
                                                  <div
                                                    class="col-3"
                                                    *ngFor="
                                                      let num of [1, 2, 3]
                                                    "
                                                  >
                                                    <a
                                                      class="btn btn-light calc-btn w-100"
                                                      (click)="
                                                        appendNumber(
                                                          num,
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >{{ num }}</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-warning calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '-',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >-</a
                                                    >
                                                  </div>
                                                </div>
                                                <div class="row g-1 mt-1">
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-light calc-btn w-100"
                                                      (click)="
                                                        appendNumber(
                                                          0,
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >0</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-light calc-btn w-100"
                                                      (click)="
                                                        appendDecimal(
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >.</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-danger calc-btn w-100"
                                                      (click)="
                                                        clear($index, true)
                                                      "
                                                      >C</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-warning calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '+',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >+</a
                                                    >
                                                  </div>
                                                </div>
                                                <div class="row g-1 mt-1">
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-secondary calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '(',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >(</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-secondary calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          ')',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >)</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-secondary calc-btn w-100"
                                                      (click)="
                                                        insertOperation(
                                                          '%',
                                                          $index,
                                                          true
                                                        )
                                                      "
                                                      >%</a
                                                    >
                                                  </div>
                                                  <div class="col-3">
                                                    <a
                                                      class="btn btn-success calc-btn w-100"
                                                      (click)="
                                                        evaluateDeductionFormula(
                                                          $index
                                                        );template.hide()
                                                      "
                                                      >=</a
                                                    >
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <!--                         
                                              <input
                                                type="text"
                                                class="form-control"
                                                formControlName="formula"
                                                placeholder="Enter formula (e.g., netSalary + totalAmount)"
                                              />
                                              <small class="text-muted">
                                                Use valid expressions for calculation.
                                              </small>
                                     
                                              <div class="mt-2">
                                                <label for="variables">Choose Variables:</label>
                                                <div>
                                                  <a
                                                    *ngFor="let variable of availableVariables"
                                                    class="btn btn-outline-secondary btn-sm"
                                                    (click)="insertVariable(variable, $index, true)"
                                                  >
                                                    {{ variable.name }}: {{ variable.value }}
                                                  </a>
                                                </div>
                                              </div>
                            
                                              <div class="mt-2">
                                                <label for="operations">Choose Operations:</label>
                                                <div>
                                                  <a
                                                    *ngFor="let operation of operations"
                                                    class="btn btn-outline-secondary btn-sm"
                                                    (click)="insertOperation(operation, $index, true)"
                                                  >
                                                    {{ operation }}
                                                  </a>
                                                </div>
                                              </div>
                                              <button
                                                type="button"
                                                class="btn btn-outline-secondary btn-sm mt-2"
                                                (click)="evaluateDeductionFormula($index)"
                                              >
                                                Evaluate
                                              </button> -->
                                </div>

                                <div
                                  *ngIf="
                                    data.get('formula')?.invalid &&
                                    data.get('formula')?.touched &&
                                    data.get('calculationType')?.value ===
                                      'formula'
                                  "
                                >
                                  <small class="invalid-text"
                                    >Formula is required.</small
                                  >
                                </div>
                              </td>
                              <td class="text-end">
                                <input
                                  type="number"
                                  [value]="data.get('amount')?.value"
                                  class="form-control text-end"
                                  formControlName="amount"
                                  (input)="
                                    calculateTotalAmount();
                                    onFormulaInputDeduction($event, $index)
                                  "
                                  [readonly]="
                                    data
                                      .get('calculationType')
                                      ?.value?.trim() !== 'custom'
                                  "
                                />
                              </td>
                              <td class="product-removal">
                                @if($index >2){
                                <a
                                  class="btn btn-danger"
                                  (click)="
                                    removeDeductionRow($index, 'deductions')
                                  "
                                >
                                  <i class="ri-delete-bin-2-line"></i
                                ></a>
                                }
                              </td>
                            </tr>
                            }
                          </tbody>
                          <tbody>
                            <tr>
                              <td colspan="5">
                                <a
                                  id="add-item"
                                  class="fw-medium"
                                  (click)="addDeduction()"
                                  ><i class="ri-add-fill me-1 align-bottom"></i>
                                  Add Deduction</a
                                >
                              </td>
                            </tr>
                          </tbody>
                          <tfoot class="table-light">
                            <tr>
                              <td colspan="2">
                                <strong>Total Deduction</strong>
                              </td>
                              <td colspan="2" class="text-end">
                                <i class="bx bx-rupee"></i>
                                {{ deductionsTotal | number:'1.0-2'}}
                              </td>
                              <td></td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    </th>
                  </tr>
                </tbody>
              </table>
              <div class="">
                <table
                  class="table table-bordered table-nowrap align-middle mb-0 ms-auto ml-5"
                >
                  <tbody>
                    <tr class="border-top border-top-dashed fs-base">
                      <th scope="row">Net Pay :</th>
                      <th class="text-end">
                        <i class="bx bx-rupee"></i>{{ this.totalAmount| number:'1.0-2' }}
                      </th>
                    </tr>

                    <tr>
                      <th scope="row">In Words :</th>
                      <th class="text-end">
                        <i class="bx bx-rupee"></i> {{ convertNumberToWords(totalAmount || 0) }}
                      </th>
                    </tr>
                  </tbody>
                </table>
                <!--end table-->
              </div>

              <div class="mt-3">
                <table
                  class="table table-bordered table-nowrap align-middle mb-0 ml-5"
                >
                  <thead>
                    <tr class="table-light">
                      <th scope="col" colspan="3">
                        Employer's Contribution (CTC)
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-top border-top-dashed fs-base">
                      <td scope="row">Earning Gross:</td>
                      <td></td>
                      <td class="text-end">
                        <i class="bx bx-rupee"></i>{{ earningTotal | number:'1.0-2'}}
                      </td>
                    </tr>
                    <tr>
                      <th scope="row">Employer's Provident Fund</th>
                      <td></td>
                      <td class="text-end">
                        @if(employeerPfAmount){
                            <i class="bx bx-rupee"></i>{{ employeerPfAmount | number:'1.0-2'}}
                        }        
                      </td>
                    </tr>
                    <tr>
                      <td colspan="1" class="ps-4 text-start">
                        &gt; Pension Fund
                      </td>
                      <td></td>
                      <td class="text-end"></td>
                    </tr>
                    <tr>
                      <td colspan="1" class="ps-4 text-start">
                        &gt; Provident Fund
                      </td>
                      <td>
                        @if(employeerPfAmount){
                            <i class="bx bx-rupee"></i>{{ employeerPfAmount | number:'1.0-2'}}
                        }    
                      </td>
                      <td class="text-end"></td>
                    </tr>
                    <tr>
                      <th scope="row">Employer's State Insurance</th>
                      <td></td>
                      <td class="text-end">
                        <i class="bx bx-rupee"></i>{{ employeerEsiAmount| number:'1.0-2' }}
                      </td>
                    </tr>

                    <tr class="table-light">
                      <th scope="row">Total CTC</th>

                      <td class="text-end" colspan="2">
                       <strong><i class="bx bx-rupee"></i>{{ totalctc | number:'1.0-2'}}</strong> 
                      </td>
                    </tr>
                    <tr class="table-light">
                      <th scope="row">In Words</th>

                      <td class="text-end" colspan="2">
                      <strong><i class="bx bx-rupee"></i>
                        {{ convertNumberToWords(totalctc || 0) }}</strong>  
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>



<div
  bsModal
  #tooltipmodal="bs-modal"
  class="modal fade"
  id="exampleModalPopovers"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Payslip</h5>
        <button
          type="button"
          class="btn-close"
          (click)="tooltipmodal.hide()"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row justify-content-center">
          <div class="col-xxl-12">
            <div class="hstack gap-2 justify-content-end d-print-none mb-4">
              <a href="javascript:window.print()" class="btn btn-success"
                ><i class="ri-printer-line align-bottom me-1"></i> Print</a
              >
            </div>
            <div class=" overflow-hidden myDivToPrint" id="invoice">
              <div class=" z-1 position-relative">
                <div class="d-flex">
                  <div class="flex-grow-1">
                    <img
                      src="/assets/payslip-header.png"
                      class="card-logo img-fluid"
                      alt="logo light"
                    />
                  </div>
                </div>

                <div class="col-12 bg-light text-center py-3">
                  <h6 class="fw-bold">A B Pal Electricals (P) Limited</h6>
                  <h6 class="fw-normal">
                    1826, Bhagirath Palace, Chandni Chowk, Delhi-110006, India
                  </h6>
                  <h6 class="fw-normal">
                    Phone: +91 98914 98555, +9111 43 111 333
                  </h6>
                  <h6 class="fw-normal">Email Id: contact&#64;abpal.com</h6>
                  <h6 class="fw-normal mb-0">Website: www.abpal.com</h6>
                </div>

                <div class="col-12 ">
                    <div class="mt-2">
                        <div class=" bg-light text-center p-2">
                       <strong>Pay Slip for
                        {{ payslipData?.payslip_for_month | date : "MMMM, YYYY" }}</strong>   
                        </div>
                      </div>
                     
                </div>
                <div class="row mt-3">
                   
                      <div class="col-6">
                        <h6>
                          Employee Name :&nbsp;<span
                            class="text-muted fw-normal"
                            >{{ empData?.name }}</span
                          >
                        </h6>
                        <h6>
                          Employee Code :&nbsp;<span
                            class="text-muted fw-normal"
                            >{{ empData?.employee_id }}</span
                          >
                        </h6>
                        <h6>
                          Work Location :&nbsp;<span
                            class="text-muted fw-normal"
                            >{{ empData?.branch }}</span
                          >
                        </h6>
                        <h6>
                          Designation :&nbsp;<span class="text-muted fw-normal">{{
                            empData?.designation_name
                          }}</span>
                        </h6>
                        <h6>
                          Department :&nbsp;<span class="text-muted fw-normal">{{
                            empData?.department_name
                          }}</span>
                        </h6>
                      </div>
  
                      <div class="col-6">
                        <h6>
                          Date of Joining :&nbsp;<span
                            class="text-muted fw-normal"
                            >{{ empData?.joining_date  | date : "dd MMM, YYYY"}}</span
                          >
                        </h6>
                        <h6>
                          Aadhar No. :&nbsp;<span class="text-muted fw-normal">{{
                            empBackGroundData?.aadhaar
                          }}</span>
                        </h6>
                        <h6>
                          PAN No. :&nbsp;<span class="text-muted fw-normal">{{
                            empBackGroundData?.pan
                          }}</span>
                        </h6>
                        <h6>
                          Bank Name :&nbsp;<span class="text-muted fw-normal">{{
                            empBankDetail?.bank_name
                          }}</span>
                        </h6>
                        <h6>
                          Bank A/c No. :&nbsp;<span
                            class="text-muted fw-normal"
                            >{{ empBankDetail?.acc_number }}</span
                          >
                        </h6>
                      </div>
                   
                  </div>
                <div class="row">
                  <div class="col-12">
                    <div class="table-responsive mt-2">
                      <table
                        class="table table-bordered text-center table-nowrap align-middle mb-0"
                      >
                        <thead>
                          <tr class="table-light">
                            <th scope="col" class="text-start">
                              Salary Monthly
                            </th>
                            <th scope="col" class="text-end">
                              <i class="bx bx-rupee"></i>
                              {{ this.salaryDetailData.netSalary | number:'1.0-2'}}
              
                            </th>
                            <th scope="col" class="text-start">
                              Total Paid Days
                            </th>
                            <th scope="col" class="text-end">
                              {{ payslipData?.paid_days }}
                            </th>
                          </tr>
                          <tr class="table-light">
                            <th scope="col" class="text-start">Earnings</th>
                            <th scope="col" class="text-end">Amount</th>
                            <th scope="col" class="text-start">Deductions</th>
                            <th scope="col" class="text-end">Amount</th>
                          </tr>
                        </thead>
                        <tbody id="products-list">
                          <ng-container
                            *ngFor="
                              let i of getMaxLength(
                                payslipData?.earning,
                                payslipData?.deduction
                              )
                            "
                          >
                            <tr>
                              <!-- @if(payslipData?.earning[i]?.name){ -->
                              <td class="text-start">
                                <span class="fw-medium">{{
                                  payslipData?.earning[i]?.name || ""
                                }}</span>
                              </td>
                              <td class="text-end">
                                @if( payslipData?.earning[i]?.amount){
                                <i class="bx bx-rupee"></i>
                                {{ payslipData?.earning[i]?.amount | number:'1.0-2' }}
                                }@else if (!payslipData?.earning[i]?.name) {
                                    
                                }@else {
                                    Nil 
                                }
                              </td>
                              <!-- }  -->
                              <!-- @if(payslipData?.deduction[i]?.name){ -->
                              <td class="text-start">
                                <span class="fw-medium">{{
                                  payslipData?.deduction[i]?.name || ""
                                }}</span>
                              </td>
                              <td class="text-end">
                                @if( payslipData?.deduction[i]?.amount){
                                <i class="bx bx-rupee"></i>
                                {{ payslipData?.deduction[i]?.amount | number:'1.0-2' }}
                                }@else if (!payslipData?.deduction[i]?.name) {

                                }
                                 @else { Nil }
                              </td>
                              <!-- } -->
                            </tr>
                          </ng-container>
                        </tbody>
                        <tfoot>
                          <tr class="table-light">
                            <td class="text-start">
                              <strong>Total Earnings</strong>
                            </td>
                            <td class="text-end">
                               <i class="bx bx-rupee"></i> {{ payslipData?.earning_amount | number:'1.0-2'}}
                            </td>
                            <td class="text-start">
                              <strong>Total Deductions</strong>
                            </td>
                            <td class="text-end">
                               <i class="bx bx-rupee"></i> {{ payslipData?.deduction_amount | number:'1.0-2'}}
                            </td>
                          </tr>
                        </tfoot>
                      </table>
                    </div>
                  </div>
                </div>

                <div
                  class="border-top border-top-dashed mt-1"
                  id="products-list-total"
                >
                  <table
                    class="table table-bordered table-nowrap align-middle mb-0"
                  >
                    <tbody>
                      <tr class="border-top border-top-dashed fs-base">
                        <th scope="row">Net Pay</th>
                        <th class="text-end">
                          <i class="bx bx-rupee"></i>{{ payslipData?.net_pay | number:'1.0-2'}}
                        </th>
                      </tr>
                      <tr>
                        <th scope="row">In Words:</th>
                        <th class="text-end">
                            <i class="bx bx-rupee"></i>  {{ convertNumberToWords(payslipData?.net_pay || 0) }}
                        </th>
                      </tr>
                    </tbody>
                  </table>

                  <div class=" mt-2">
                    <table
                      class="table table-bordered table-nowrap align-middle mb-0 ml-5"
                     
                    >
                      <thead>
                        <tr class="table-light">
                          <th scope="col" colspan="3">
                            Employer's Contribution (CTC)
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="border-top border-top-dashed fs-base">
                          <td scope="row">Earning Gross:</td>
                          <td></td>
                          <td class="text-end">
                            <i class="bx bx-rupee"></i
                            >{{ payslipData?.employeer_ctc?.totalEarning | number:'1.0-2'}}
                          </td>
                        </tr>
                        <tr>
                          <th scope="row">Employer's Provident Fund</th>
                          <td></td>
                          <td class="text-end">
                            @if(payslipData?.employeer_ctc?.employeerPfAmount){
                                <i class="bx bx-rupee"></i
                                    >{{ payslipData?.employeer_ctc?.employeerPfAmount | number:'1.0-2'}}
                            }@else {
                                Nil
                            }
                          </td>
                        </tr>
                        <tr>
                          <td colspan="1" class="ps-4 text-start">
                            &gt; Pension Fund
                          </td>
                          <td class="text-end">Nil</td>
                          <td class="text-end"></td>
                        </tr>
                        <tr>
                          <td colspan="1" class="ps-4 text-start">
                            &gt; Provident Fund
                          </td>
                          <td class="text-end">
                            @if(payslipData?.employeer_ctc?.employeerPfAmount){
                                <i class="bx bx-rupee"></i
                                    >{{ payslipData?.employeer_ctc?.employeerPfAmount | number:'1.0-2'}}
                            }@else {
                                Nil
                            }
                            
                          </td>
                          <td class="text-end"></td>
                        </tr>
                        <tr>
                          <th scope="row">Employer's State Insurance</th>
                          <td></td>
                          <td class="text-end">
                            @if(payslipData?.employeer_ctc?.employeerEsiAmount){
                                <i class="bx bx-rupee"></i
                                    >{{
                                      payslipData?.employeer_ctc?.employeerEsiAmount| number:'1.0-2'
                                    }}
                            }@else {
                                Nil
                            }
                            
                          </td>
                        </tr>

                        <tr class="table-light">
                          <th scope="row">Total CTC</th>

                          <td class="text-end" colspan="2">
                         <strong><i class="bx bx-rupee"></i
                            > {{ payslipData?.employeer_ctc?.totalctc | number:'1.0-2'}}</strong>   
                          </td>
                        </tr>
                        <tr class="table-light">
                          <th scope="row">In Words</th>

                          <td class="text-end" colspan="2">
                            <i class="bx bx-rupee"></i>
                           <strong>{{
                            convertNumberToWords(
                              payslipData?.employeer_ctc?.totalctc || 0
                            )
                          }}</strong> 
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>


                  <div class=" mt-2">
                    <table
                      class="table table-bordered table-nowrap align-middle mb-0 ml-5"
                     
                    >
                     
                      <tbody>
                      
                        <tr class="table-light">
                          <th scope="row">Gross Salary</th>

                          <td class="text-end" colspan="2">
                         <strong><i class="bx bx-rupee"></i
                            > {{ payslipData?.employeer_ctc?.totalEarning | number:'1.0-2'}}</strong>   
                          </td>
                        </tr>
                        <!-- <tr class="table-light">
                          <th scope="row">In Words</th>

                          <td class="text-end" colspan="2">
                            <i class="bx bx-rupee"></i>
                           <strong>{{
                            convertNumberToWords(
                              payslipData?.employeer_ctc?.totalctc || 0
                            )
                          }}</strong> 
                          </td>
                        </tr> -->
                      </tbody>
                    </table>
                  </div>

                  <!--end table-->
                </div>

        
                  <div class="mb-0 mt-3 bg-light text-center py-2 ">
                    
                    <span id="note">
                        This is a computer-generated document and does not require a signature.
                    </span>
                  </div>
             
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>